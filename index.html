<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WNJ Designs – Client Task Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= THEME ================= */
:root{
  --primary:#2f8f5b;      /* vintage green */
  --secondary:#2b2b2b;    /* dark gray */
  --accent:#e5e7eb;       /* light gray */
  --bg:#f6f7f9;           /* soft background */
  --danger:#d64545;
}

/* ================= GLOBAL ================= */
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:var(--bg);color:#111}
header{
  background:var(--secondary);
  color:#fff;
  padding:14px 18px;
  font-weight:bold;
}

/* ================= LAYOUT ================= */
#app{display:flex;height:calc(100vh - 56px)}
#sidebar{
  width:260px;
  background:#1f2933;
  color:#fff;
  padding:12px;
}
#sidebar h3{margin-top:0;color:#d1d5db}

.client-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:4px;
}
.client{
  padding:8px;
  border-radius:6px;
  cursor:pointer;
  flex:1;
}
.client.active,.client:hover{
  background:var(--primary);
}
.client-del{
  background:none;
  border:none;
  color:#ff6b6b;
  cursor:pointer;
  font-size:14px;
}

#main{
  flex:1;
  padding:20px;
  overflow:auto;
}

/* ================= CONTROLS ================= */
.controls button{
  margin-right:6px;
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:var(--primary);
  color:#fff;
}
.controls button:hover{opacity:.9}

/* ================= TABLE ================= */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:8px;
  overflow:hidden;
}
th{
  background:#f0f2f5;
  text-align:left;
}
th,td{
  padding:10px;
  border-bottom:1px solid var(--accent);
}
tr.done td{color:var(--primary)}
.status.pending{color:#f59e0b;font-weight:bold}
.status.done{color:var(--primary);font-weight:bold}

input{
  width:100%;
  border:1px solid var(--accent);
  padding:6px;
  border-radius:4px;
}

/* ================= PRINT ================= */
@media print{
  #sidebar,.controls,button{display:none}
}
</style>
</head>

<body>

<header>WNJ Designs – Admin Dashboard</header>

<div id="app">

<!-- SIDEBAR -->
<aside id="sidebar">
  <h3>Clients</h3>
  <div id="clients"></div>
  <button onclick="addClient()" style="width:100%;margin-top:8px;">+ Add Client</button>
</aside>

<!-- MAIN -->
<main id="main">
  <h2 id="title"></h2>

  <div class="controls">
    <button onclick="addTask()">+ Add Task</button>
    <button onclick="save()">Save</button>
    <button onclick="share()">Share Preview</button>
    <button onclick="exportExcel()">Export Excel</button>
    <button onclick="window.print()">Print</button>
  </div>

  <br>

  <table>
    <thead>
      <tr>
        <th>SR</th>
        <th>Task</th>
        <th>Status</th>
        <th class="admin-only">Move</th>
        <th class="admin-only">Action</th>
      </tr>
    </thead>
    <tbody id="tasks"></tbody>
  </table>
</main>

</div>

<script>
/* ================= DEFAULT TASKS ================= */
const DEFAULT_TASKS=[
"Letterhead (A4 – print + digital)","Business Card","Invoice Template","Email Signature",
"Company Stamp / Seal","Quotation / Proposal Template","Contract / Agreement Template",
"Presentation Slides","Folder / Document Cover","Company Profile (PDF)",
"Social Media Post Templates","Social Media Cover Banners","Thank You / Compliment Card",
"Envelope Design","Letterhead Watermark Pattern","Internal Memo Template",
"Meeting Agenda Template","Report Template","Notepad / Writing Pad",
"Zoom / Google Meet Background","USB / Digital Folder Branding",
"ID Card","Lanyard","Office Signage","Packaging Design"
];

/* ================= STATE ================= */
const url=new URL(location.href);
const previewClient=url.searchParams.get("preview");
const isPreview=!!previewClient;

let data=JSON.parse(localStorage.getItem("wnj"))||{
  clients:{
    "Oxlam UG":{
      tasks:DEFAULT_TASKS.map(t=>({name:t,status:"pending"}))
    }
  }
};

let current=isPreview?previewClient:"Oxlam UG";

/* ================= PREVIEW LOCK ================= */
if(isPreview){
  document.getElementById("sidebar").remove();
  document.querySelector(".controls").remove();
  document.querySelectorAll(".admin-only").forEach(e=>e.remove());
}

/* ================= CLIENT LIST ================= */
function renderClients(){
  if(isPreview) return;
  clients.innerHTML="";
  Object.keys(data.clients).forEach(c=>{
    const row=document.createElement("div");
    row.className="client-row";

    const d=document.createElement("div");
    d.className="client"+(c===current?" active":"");
    d.textContent=c;
    d.onclick=()=>{current=c;render()};
    row.appendChild(d);

    const del=document.createElement("button");
    del.textContent="✖";
    del.className="client-del";
    del.onclick=(e)=>{
      e.stopPropagation();
      deleteClient(c);
    };
    row.appendChild(del);

    clients.appendChild(row);
  });
}

/* ================= RENDER TASKS ================= */
function render(){
  title.textContent=current;
  tasks.innerHTML="";
  data.clients[current].tasks.forEach((t,i)=>{
    const tr=document.createElement("tr");
    if(t.status==="done") tr.classList.add("done");

    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${isPreview?t.name:`<input value="${t.name}" onchange="editTask(${i},this.value)">`}</td>
      <td class="status ${t.status}">${t.status}</td>
      ${isPreview?"":`
      <td>
        <button onclick="moveUp(${i})">↑</button>
        <button onclick="moveDown(${i})">↓</button>
      </td>
      <td>
        <button onclick="toggle(${i})">Toggle</button>
        <button onclick="delTask(${i})">✖</button>
      </td>`}
    `;
    tasks.appendChild(tr);
  });
  renderClients();
}

/* ================= TASK ACTIONS ================= */
function addTask(){
  const t=prompt("Task name");
  if(!t) return;
  data.clients[current].tasks.push({name:t,status:"pending"});
  save();render();
}
function editTask(i,v){data.clients[current].tasks[i].name=v;save();}
function toggle(i){
  const t=data.clients[current].tasks[i];
  t.status=t.status==="pending"?"done":"pending";
  save();render();
}
function delTask(i){
  if(!confirm("Delete task?")) return;
  data.clients[current].tasks.splice(i,1);
  save();render();
}
function moveUp(i){
  if(i===0) return;
  const a=data.clients[current].tasks;
  [a[i-1],a[i]]=[a[i],a[i-1]];
  save();render();
}
function moveDown(i){
  const a=data.clients[current].tasks;
  if(i===a.length-1) return;
  [a[i+1],a[i]]=[a[i],a[i+1]];
  save();render();
}

/* ================= CLIENT ACTIONS ================= */
function addClient(){
  const n=prompt("Client name");
  if(!n||data.clients[n]) return;
  data.clients[n]={tasks:[]};
  current=n;
  save();render();
}

function deleteClient(name){
  const auth=prompt(`Type client name "${name}" to confirm delete`);
  if(auth!==name){
    alert("Authorization failed");
    return;
  }
  delete data.clients[name];
  current=Object.keys(data.clients)[0]||"";
  save();render();
}

/* ================= SAVE / SHARE / EXPORT ================= */
function save(){localStorage.setItem("wnj",JSON.stringify(data));}

function share(){
  const link=location.origin+location.pathname+"?preview="+encodeURIComponent(current);
  navigator.clipboard.writeText(link);
  alert("Preview link copied");
}

function exportExcel(){
  let csv="SR,Task,Status\n";
  data.clients[current].tasks.forEach((t,i)=>{
    csv+=`${i+1},"${t.name}","${t.status}"\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=current.replace(/\s+/g,"_")+"_Tasks.xlsx";
  a.click();
}

/* ================= INIT ================= */
render();
</script>

</body>
</html>
