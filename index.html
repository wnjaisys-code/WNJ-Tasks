<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>WNJ Designs – Dashboard</title>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root{
  --primary:#2f6f5e;
  --bg:#f4f6f5;
  --card:#ffffff;
  --text:#1f2937;
}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text)}
header{background:var(--primary);color:#fff;padding:12px 20px}
main{display:flex;height:calc(100vh - 50px)}
aside{width:260px;background:#fff;border-right:1px solid #ddd;padding:10px;overflow:auto}
section{flex:1;padding:15px;overflow:auto}
button{cursor:pointer}
.client{padding:6px;border-radius:6px;margin-bottom:4px;display:flex;justify-content:space-between;align-items:center}
.client.active{background:#e6f3ef}
.client button{background:none;border:none}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ddd;padding:6px;text-align:left}
.actions button{margin-right:5px}
.preview * .admin-only{display:none}
</style>
</head>

<body>

<header>
  <b>WNJ Designs – Admin Dashboard</b>
  <button onclick="togglePreview()" style="float:right">Preview</button>
</header>

<main id="app">
  <aside class="admin-only">
    <button onclick="addClient()">➕ Add Client</button>
    <div id="clients"></div>
  </aside>

  <section>
    <h3 id="clientTitle">Select Client</h3>

    <div class="admin-only">
      <input id="taskInput" placeholder="New task..." />
      <button onclick="addTask()">Add</button>

      <input type="file" id="importFile" onchange="importTasks(event)" />
      <button onclick="exportXLSX()">Export XLSX</button>
      <button onclick="exportTXT()">Export TXT</button>
      <button onclick="exportPDF()">Export PDF</button>
      <button onclick="exportPlain()">Plain Text</button>
    </div>

    <table id="taskTable">
      <thead>
        <tr>
          <th>SR#</th>
          <th>Task</th>
          <th>Status</th>
          <th class="admin-only">Move</th>
          <th class="admin-only">Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script>
let data = JSON.parse(localStorage.getItem("wnj")) || {clients:{}};
let current=null;
let preview=false;

function save(){localStorage.setItem("wnj",JSON.stringify(data));}

function renderClients(){
  const box=document.getElementById("clients");
  box.innerHTML="";
  Object.keys(data.clients).forEach(c=>{
    const d=document.createElement("div");
    d.className="client"+(c===current?" active":"");
    d.onclick=()=>{current=c;render();}
    d.innerHTML=`
      <span>${c}</span>
      <span>
        <button onclick="editClient(event,'${c}')">✏️</button>
        <button onclick="deleteClient(event,'${c}')">❌</button>
      </span>`;
    box.appendChild(d);
  });
}

function addClient(){
  const n=prompt("Client name?");
  if(!n||data.clients[n])return;
  data.clients[n]=[];
  current=n; save(); render();
}

function editClient(e,name){
  e.stopPropagation();
  const n=prompt("Edit client name",name);
  if(!n||n===name||data.clients[n])return;
  data.clients[n]=data.clients[name];
  delete data.clients[name];
  if(current===name)current=n;
  save(); render();
}

function deleteClient(e,name){
  e.stopPropagation();
  const confirmName=prompt(`Type "${name}" to delete`);
  if(confirmName!==name)return;
  delete data.clients[name];
  current=null;
  save(); render();
}

function renderTasks(){
  const tb=document.querySelector("#taskTable tbody");
  tb.innerHTML="";
  if(!current)return;
  data.clients[current].forEach((t,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${t.text}</td>
      <td>${t.status}</td>
      <td class="admin-only">
        <button onclick="moveTask(${i},-1)">↑</button>
        <button onclick="moveTask(${i},1)">↓</button>
      </td>
      <td class="admin-only actions">
        <button onclick="editTask(${i})">✏️</button>
        <button onclick="delTask(${i})">❌</button>
      </td>`;
    tb.appendChild(tr);
  });
}

function addTask(){
  if(!current)return;
  const v=document.getElementById("taskInput").value;
  if(!v)return;
  data.clients[current].push({text:v,status:"Pending"});
  document.getElementById("taskInput").value="";
  save(); renderTasks();
}

function editTask(i){
  const n=prompt("Edit task",data.clients[current][i].text);
  if(!n)return;
  data.clients[current][i].text=n;
  save(); renderTasks();
}

function delTask(i){
  data.clients[current].splice(i,1);
  save(); renderTasks();
}

function moveTask(i,d){
  const arr=data.clients[current];
  const ni=i+d;
  if(ni<0||ni>=arr.length)return;
  [arr[i],arr[ni]]=[arr[ni],arr[i]];
  save(); renderTasks();
}

/* IMPORT */
function importTasks(e){
  const f=e.target.files[0];
  if(!f||!current)return;
  const r=new FileReader();
  r.onload=()=>{
    r.result.split(/\r?\n/).forEach(l=>{
      if(l.trim()) data.clients[current].push({text:l.trim(),status:"Pending"});
    });
    save(); renderTasks();
  };
  r.readAsText(f);
}

/* EXPORT */
function exportXLSX(){
  const ws=XLSX.utils.json_to_sheet(data.clients[current]);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Tasks");
  XLSX.writeFile(wb,"tasks.xlsx");
}
function exportTXT(){
  download(data.clients[current].map(t=>t.text).join("\n"),"tasks.txt");
}
function exportPlain(){exportTXT();}
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  data.clients[current].forEach((t,i)=>pdf.text(`${i+1}. ${t.text}`,10,10+i*8));
  pdf.save("tasks.pdf");
}
function download(c,n){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([c]));
  a.download=n; a.click();
}

function togglePreview(){
  preview=!preview;
  document.getElementById("app").classList.toggle("preview",preview);
}

function render(){
  renderClients();
  document.getElementById("clientTitle").innerText=current||"Select Client";
  renderTasks();
}
render();
</script>

</body>
</html>
