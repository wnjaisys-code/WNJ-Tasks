<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WNJ Designs ‚Äì Admin Dashboard</title>

<style>
:root{
  --primary:#2f6f5f;
  --bg:#f4f6f5;
  --border:#dcdcdc;
}
body{
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  background:var(--bg);
}
header{
  background:var(--primary);
  color:#fff;
  padding:14px 20px;
}
.container{padding:20px;}
.flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
button,select,input{
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:4px;
}
button{
  background:var(--primary);
  color:#fff;
  cursor:pointer;
}
button.gray{background:#666;}
button.red{background:#a33;}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  border:1px solid var(--border);
  padding:8px;
}
th{background:#eee;}
.hidden{display:none;}
</style>
</head>

<body>

<header>
  <h2>WNJ Designs ‚Äì Admin Dashboard</h2>
</header>

<div class="container">

<!-- ADMIN CONTROLS -->
<div id="adminControls" class="flex">
  <input id="newClient" placeholder="New client name">
  <button onclick="addClient()">Add Client</button>
  <button class="gray" onclick="copyPreview()">Client Preview</button>

  <select onchange="handleImport(this.value)">
    <option value="">Import Tasks</option>
    <option value="txt">TXT / Plain</option>
    <option value="xlsx">XLSX</option>
    <option value="pdf">PDF</option>
  </select>

  <select onchange="exportTasks(this.value)">
    <option value="">Export</option>
    <option value="txt">TXT</option>
    <option value="plain">Plain</option>
    <option value="xlsx">XLSX</option>
    <option value="word">Word</option>
    <option value="pdf">PDF</option>
  </select>

  <button onclick="window.print()">Print</button>
</div>

<hr>

<!-- CLIENTS -->
<div id="clientsSection">
  <h3>Clients</h3>
  <div id="clients"></div>
</div>

<hr>

<!-- TASKS -->
<h3 id="taskTitle"></h3>

<div id="taskControls" class="flex">
  <input id="newTask" placeholder="New task">
  <button onclick="addTask()">Add Task</button>
</div>

<table>
<thead>
<tr>
  <th>Sr #</th>
  <th>Task</th>
  <th>Status</th>
  <th id="actionHeader">Actions</th>
</tr>
</thead>
<tbody id="taskBody"></tbody>
</table>

</div>

<script>
/* ================= DATA ================= */
let data = JSON.parse(localStorage.getItem("wnjData")) || {clients:{}};
let currentClient = null;

/* ================= PREVIEW MODE ================= */
const params = new URLSearchParams(window.location.search);
const previewMode = params.get("preview")==="1";
const previewClient = params.get("client");

/* ================= PREVIEW CLIENT LOAD ================= */
if(previewMode && previewClient){
  currentClient = decodeURIComponent(previewClient);
}

/* ================= PREVIEW HIDING ================= */
if(previewMode){
  document.getElementById("adminControls").classList.add("hidden");
  document.getElementById("taskControls").classList.add("hidden");
  document.getElementById("clientsSection").classList.add("hidden");
  document.getElementById("actionHeader").classList.add("hidden");
}

/* ================= SAVE ================= */
function save(){
  localStorage.setItem("wnjData",JSON.stringify(data));
}

/* ================= CLIENTS ================= */
function addClient(){
  const n=newClient.value.trim();
  if(!n) return;
  if(data.clients[n]) return alert("Client exists");
  data.clients[n]={tasks:[]};
  newClient.value="";
  save();renderClients();
}

function renderClients(){
  const c=document.getElementById("clients");
  c.innerHTML="";
  Object.keys(data.clients).forEach(name=>{
    const row=document.createElement("div");
    row.className="flex";

    const b=document.createElement("button");
    b.textContent=name;
    b.onclick=()=>selectClient(name);
    row.appendChild(b);

    if(!previewMode){
      const e=document.createElement("button");
      e.textContent="‚úèÔ∏è";
      e.onclick=()=>editClient(name);

      const d=document.createElement("button");
      d.textContent="üóë";
      d.className="red";
      d.onclick=()=>deleteClient(name);

      row.append(e,d);
    }
    c.appendChild(row);
  });
}

function editClient(oldName){
  const n=prompt("Rename client",oldName);
  if(!n||n===oldName) return;
  if(data.clients[n]) return alert("Exists");
  data.clients[n]=data.clients[oldName];
  delete data.clients[oldName];
  currentClient=n;
  save();renderClients();renderTasks();
}

function deleteClient(name){
  const c=prompt(`Type "${name}" to delete`);
  if(c!==name) return;
  delete data.clients[name];
  currentClient=null;
  save();renderClients();renderTasks();
}

function selectClient(name){
  currentClient=name;
  renderTasks();
}

/* ================= TASKS ================= */
function renderTasks(){
  const body=document.getElementById("taskBody");
  const title=document.getElementById("taskTitle");
  body.innerHTML="";
  if(!currentClient || !data.clients[currentClient]){
    title.textContent="";
    return;
  }

  title.textContent="Tasks ‚Äì "+currentClient;

  data.clients[currentClient].tasks.forEach((t,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${t.title}</td>
      <td>${t.status}</td>
      ${previewMode ? "" : `<td>
        <button onclick="moveTask(${i},-1)">‚¨Ü</button>
        <button onclick="moveTask(${i},1)">‚¨á</button>
        <button onclick="editTask(${i})">‚úèÔ∏è</button>
        <button class="red" onclick="delTask(${i})">üóë</button>
      </td>`}
    `;
    body.appendChild(tr);
  });
}

function addTask(){
  if(!currentClient) return;
  const t=newTask.value.trim();
  if(!t) return;
  data.clients[currentClient].tasks.push({title:t,status:"Pending"});
  newTask.value="";
  save();renderTasks();
}

function editTask(i){
  const t=prompt("Edit task",data.clients[currentClient].tasks[i].title);
  if(!t) return;
  data.clients[currentClient].tasks[i].title=t;
  save();renderTasks();
}

function delTask(i){
  data.clients[currentClient].tasks.splice(i,1);
  save();renderTasks();
}

function moveTask(i,d){
  const arr=data.clients[currentClient].tasks;
  const ni=i+d;
  if(ni<0||ni>=arr.length) return;
  [arr[i],arr[ni]]=[arr[ni],arr[i]];
  save();renderTasks();
}

/* ================= CLIENT‚ÄëWISE PREVIEW LINK ================= */
function copyPreview(){
  if(!currentClient) return alert("Select a client first");
  const link = location.origin + location.pathname +
    "?preview=1&client=" + encodeURIComponent(currentClient);
  navigator.clipboard.writeText(link);
  alert("Client Preview link copied:\n"+link);
}

/* ================= IMPORT ================= */
function handleImport(type){
  if(!type||!currentClient) return;
  const f=document.createElement("input");
  f.type="file";
  f.onchange=()=>{
    const r=new FileReader();
    r.onload=e=>{
      e.target.result.split(/\r?\n/).forEach(l=>{
        if(l.trim()){
          data.clients[currentClient].tasks.push({title:l.trim(),status:"Pending"});
        }
      });
      save();renderTasks();
    };
    r.readAsText(f.files[0]);
  };
  f.click();
}

/* ================= EXPORT ================= */
function exportTasks(type){
  if(!currentClient) return;
  const t=data.clients[currentClient].tasks;
  if(!t.length) return;
  const text=t.map((x,i)=>`${i+1}. ${x.title} - ${x.status}`).join("\n");
  const blob=new Blob([text],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=currentClient+"_tasks."+type;
  a.click();
}

/* ================= INIT ================= */
renderClients();
if(currentClient) renderTasks();
</script>

</body>
</html>
