<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WNJ Designs ‚Äì Admin Dashboard</title>
<style>
:root{
  --primary:#2f6f5f;
  --secondary:#2e2e2e;
  --bg:#f4f6f5;
  --border:#dcdcdc;
}
body{
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  background:var(--bg);
}
header{
  background:var(--primary);
  color:#fff;
  padding:12px 20px;
}
.container{padding:20px;}
.flex{display:flex;gap:10px;align-items:center;}
button,select,input{
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:4px;
}
button{
  background:var(--primary);
  color:#fff;
  cursor:pointer;
}
button.gray{background:#666;}
button.red{background:#a33;}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  border:1px solid var(--border);
  padding:8px;
}
th{background:#eee;}
.actions button{margin-right:4px;}
.hidden{display:none;}
</style>
</head>
<body>

<header>
  <h2>WNJ Designs ‚Äì Admin Dashboard</h2>
</header>

<div class="container">

<!-- ADMIN CONTROLS -->
<div id="adminControls">
  <div class="flex">
    <input id="newClient" placeholder="New client name">
    <button onclick="addClient()">Add Client</button>
    <button class="gray" onclick="copyPreview()">Client Preview</button>

    <!-- IMPORT DROPDOWN -->
    <select onchange="handleImport(this.value)">
      <option value="">Import Tasks</option>
      <option value="txt">TXT / Plain Text</option>
      <option value="xlsx">XLSX</option>
      <option value="pdf">PDF</option>
    </select>

    <!-- EXPORT DROPDOWN -->
    <select onchange="exportTasks(this.value)">
      <option value="">Export</option>
      <option value="txt">TXT</option>
      <option value="plain">Plain Text</option>
      <option value="xlsx">XLSX</option>
      <option value="word">Word</option>
      <option value="pdf">PDF</option>
    </select>

    <button onclick="window.print()">Print</button>
  </div>
</div>

<hr>

<!-- CLIENT LIST -->
<h3>Clients</h3>
<div id="clients"></div>

<hr>

<!-- TASKS -->
<h3 id="taskTitle"></h3>
<div id="taskControls" class="flex">
  <input id="newTask" placeholder="New task">
  <button onclick="addTask()">Add Task</button>
</div>

<table id="taskTable">
<thead>
<tr>
<th>Sr #</th>
<th>Task</th>
<th>Status</th>
<th class="actions">Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<script>
/* ================= DATA ================= */
let data = JSON.parse(localStorage.getItem("wnjData")) || {clients:{}};
let currentClient = null;

/* ================= PREVIEW MODE ================= */
const params = new URLSearchParams(window.location.search);
const previewMode = params.get("preview")==="1";

/* ================= INIT ================= */
if(previewMode){
  document.getElementById("adminControls").classList.add("hidden");
  document.getElementById("taskControls").classList.add("hidden");
}

renderClients();

/* ================= CLIENTS ================= */
function save(){
  localStorage.setItem("wnjData",JSON.stringify(data));
}

function addClient(){
  const name = newClient.value.trim();
  if(!name) return;
  if(data.clients[name]) return alert("Client exists");
  data.clients[name]={tasks:[]};
  newClient.value="";
  save();renderClients();
}

function renderClients(){
  const cDiv=document.getElementById("clients");
  cDiv.innerHTML="";
  Object.keys(data.clients).forEach(c=>{
    const d=document.createElement("div");
    d.className="flex";
    const b=document.createElement("button");
    b.textContent=c;
    b.onclick=()=>selectClient(c);
    d.appendChild(b);

    if(!previewMode){
      const e=document.createElement("button");
      e.textContent="‚úèÔ∏è";
      e.onclick=()=>editClient(c);
      const del=document.createElement("button");
      del.textContent="üóë";
      del.className="red";
      del.onclick=()=>deleteClient(c);
      d.append(e,del);
    }
    cDiv.appendChild(d);
  });
}

function editClient(oldName){
  const n=prompt("Rename client",oldName);
  if(!n||n===oldName) return;
  if(data.clients[n]) return alert("Exists");
  data.clients[n]=data.clients[oldName];
  delete data.clients[oldName];
  currentClient=n;
  save();renderClients();renderTasks();
}

function deleteClient(name){
  const conf=prompt(`Type "${name}" to delete`);
  if(conf!==name) return;
  delete data.clients[name];
  currentClient=null;
  save();renderClients();renderTasks();
}

function selectClient(c){
  currentClient=c;
  renderTasks();
}

/* ================= TASKS ================= */
function renderTasks(){
  const title=document.getElementById("taskTitle");
  const tbody=document.querySelector("#taskTable tbody");
  tbody.innerHTML="";
  if(!currentClient){title.textContent="";return;}
  title.textContent="Tasks ‚Äì "+currentClient;

  data.clients[currentClient].tasks.forEach((t,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td>
      <td>${t.title}</td>
      <td>${t.status}</td>
      <td class="actions"></td>`;
    if(!previewMode){
      const a=tr.querySelector(".actions");
      a.innerHTML=`
      <button onclick="moveTask(${i},-1)">‚¨Ü</button>
      <button onclick="moveTask(${i},1)">‚¨á</button>
      <button onclick="editTask(${i})">‚úèÔ∏è</button>
      <button onclick="delTask(${i})" class="red">üóë</button>`;
    }
    tbody.appendChild(tr);
  });
}

function addTask(){
  if(!currentClient) return;
  const t=newTask.value.trim();
  if(!t) return;
  data.clients[currentClient].tasks.push({title:t,status:"Pending"});
  newTask.value="";
  save();renderTasks();
}

function editTask(i){
  const t=prompt("Edit task",data.clients[currentClient].tasks[i].title);
  if(!t) return;
  data.clients[currentClient].tasks[i].title=t;
  save();renderTasks();
}

function delTask(i){
  data.clients[currentClient].tasks.splice(i,1);
  save();renderTasks();
}

function moveTask(i,d){
  const arr=data.clients[currentClient].tasks;
  const ni=i+d;
  if(ni<0||ni>=arr.length) return;
  [arr[i],arr[ni]]=[arr[ni],arr[i]];
  save();renderTasks();
}

/* ================= PREVIEW LINK ================= */
function copyPreview(){
  const link=location.origin+location.pathname+"?preview=1";
  navigator.clipboard.writeText(link);
  alert("Client Preview link copied:\n"+link);
}

/* ================= IMPORT ================= */
function handleImport(type){
  if(!type||!currentClient) return;
  const inp=document.createElement("input");
  inp.type="file";
  inp.onchange=()=>{
    const f=inp.files[0];
    const r=new FileReader();
    r.onload=e=>{
      const lines=e.target.result.split(/\r?\n/);
      lines.forEach(l=>{
        if(l.trim()){
          data.clients[currentClient].tasks.push({title:l.trim(),status:"Pending"});
        }
      });
      save();renderTasks();
    };
    r.readAsText(f);
  };
  inp.click();
}

/* ================= EXPORT ================= */
function exportTasks(type){
  if(!currentClient) return;
  const t=data.clients[currentClient].tasks;
  if(!t.length) return;
  let text=t.map((x,i)=>`${i+1}. ${x.title} - ${x.status}`).join("\n");
  const blob=new Blob([text],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="tasks."+type;
  a.click();
}
</script>
</body>
</html>
